<!DOCTYPE html>
<html lang="th"><head><meta charset="utf-8"/><title>Rainbow in Pygments</title><meta name="author" content="Sorawee Porncharoenwase"/><meta name="keywords" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="icon" href="https://homes.cs.washington.edu/~sorawee/static/favicon.ico"/><link rel="canonical" href=""/><link rel="stylesheet" type="text/css" href="https://afeld.github.io/emoji-css/emoji.css"/><link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"/><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Sarabun"/><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Source+Code+Pro"/><link rel="stylesheet" type="text/css" href="https://homes.cs.washington.edu/~sorawee/static/css/app.css"/><link rel="stylesheet" type="text/css" href="https://homes.cs.washington.edu/~sorawee/static/css/pygments.css"/><link rel="alternate" type="application/atom+xml" href="https://homes.cs.washington.edu/~sorawee/th/feed.xml"/></head>
<body><nav class="navbar navbar-expand-md navbar-light bg-light"><div class="container"><div class="navbar-brand site-info">
<h1><a href="https://homes.cs.washington.edu/~sorawee/th/index.html">สรวีย์ พรเจริญวาสน์</a></h1>
<p>PhD Student at UW CSE</p>
</div>
<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbar_collapse" aria-controls="navbar_collapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbar_collapse"><ul class="navbar-nav ml-auto"><li class="nav-item "><a class="nav-link" href="https://homes.cs.washington.edu/~sorawee/th/index.html">Home</a></li>
<li class="nav-item "><a class="nav-link" href="https://homes.cs.washington.edu/~sorawee/th/blog">Blog</a></li>
<li class="nav-item "><a class="nav-link" href="https://homes.cs.washington.edu/~sorawee/th/coq-tactics">Coq&#160;Tactics<sup>&lt;α</sup></a></li>
<li class="nav-item"><a class="nav-link" title="sorawee@cs.washington.edu" href="mailto:sorawee@cs.washington.edu" data-toggle="tooltip" data-placement="bottom"><i class="fas fa-envelope"></i></a></li>
<li class="nav-item"><a class="nav-link" title="CSE 394" href="https://norfolk.cs.washington.edu/directory/index.php?prev_floor=3&amp;show_room=CSE394" data-toggle="tooltip" data-placement="bottom"><i class="fas fa-map-marker-alt"></i></a></li>
<li class="nav-item"><a class="nav-link" title="@sorawee" href="https://www.github.com/sorawee" data-toggle="tooltip" data-placement="bottom"><i class="fab fa-github"></i></a></li>
<li class="nav-item"><a class="nav-link" title="Pollen source" href="https://github.com/sorawee/my-website/blob/master/blog/2017/01-03-rainbow-parens.html.pm" data-toggle="tooltip" data-placement="bottom"><i class="fas fa-code"></i></a></li>
<li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-language"></i></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item " href="https://homes.cs.washington.edu/~sorawee/en/blog/2017/01-03-rainbow-parens.html">อังกฤษ</a><a class="dropdown-item disabled" href="https://homes.cs.washington.edu/~sorawee/th/blog/2017/01-03-rainbow-parens.html">ไทย</a></div>
</li>
</ul>
</div>
</div>
</nav>
<main class="container"><div id="content-title--blog-2017-01-03-rainbow-parens-html" class="row content-type--post">
<div>
<h1>Rainbow in Pygments</h1>
<p>
<p><span class="pubdate">Published on Tuesday, January 3rd, 2017</span> :: <span><a href="https://homes.cs.washington.edu/~sorawee/th/tags/racket">racket</a>, <a href="https://homes.cs.washington.edu/~sorawee/th/tags/blog">blog</a>, <a href="https://homes.cs.washington.edu/~sorawee/th/tags/pygments">pygments</a></span></p>
<p class="update"><span class="pubdate">Updated on Thursday, December 6th, 2018</span></p>
<div class="post-content">
<p>I tried to learn <a href="https://en.wikipedia.org/wiki/Continuation">continuations</a> yesterday. This led me to a <a href="http://community.schemewiki.org/?p=composable-continuations-tutorial">tutorial on composable continuations</a> in schemewiki.org. It explains things nicely, but what really intrigues me is something completely different: <a href="https://www.emacswiki.org/emacs/RainbowDelimiters">rainbow parentheses</a> on mouse hovering.</p>
<p><img src="https://homes.cs.washington.edu/~sorawee/static/img/blog/01-paren-highlight.png" class="block-image " style="width: 60%"/></p>
<p>This post, of course, explains how I managed to get it on my website!</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-1"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span> <span class="n">x</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">1</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">3</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">2</span> <span class="mi">4</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">9</span> <span class="mi">9</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-1"><i class="far fa-copy"></i></button></div>
</div>
<h2>Hacking schemewiki.org</h2>
<p>Since I do not know how to implement this feature, the first step is obvious: take a look at the source code in schemewiki.org. For <code>(+ 1 (+ 3 (+ 2 4)))</code>, here’s the result:</p>
<div class="filebox"><div class="filename">http://community.schemewiki.org?composable-continuations-tutorial</div>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5
6
7
8
9</pre>
</div>
</td><td class="code"><div class="source"><pre id="code-id-2"><span></span>...
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"paren"</span><span class="p">&gt;</span>(<span class="p">&lt;</span><span class="nt">a</span>
  <span class="na">href</span><span class="o">=</span><span class="s">"http://www.schemers.org/Documents/Standards/R5RS/HTML/r5rs-Z-H-9.html#%_idx_278"</span>
      <span class="na">class</span><span class="o">=</span><span class="s">"scheme-documentation"</span><span class="p">&gt;</span>+<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> 1 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"paren"</span><span class="p">&gt;</span>(<span class="p">&lt;</span><span class="nt">a</span>
  <span class="na">href</span><span class="o">=</span><span class="s">"http://www.schemers.org/Documents/Standards/R5RS/HTML/r5rs-Z-H-9.html#%_idx_278"</span>
      <span class="na">class</span><span class="o">=</span><span class="s">"scheme-documentation"</span><span class="p">&gt;</span>+<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> 3 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"paren"</span><span class="p">&gt;</span>(<span class="p">&lt;</span><span class="nt">a</span>
  <span class="na">href</span><span class="o">=</span><span class="s">"http://www.schemers.org/Documents/Standards/R5RS/HTML/r5rs-Z-H-9.html#%_idx_278"</span>
      <span class="na">class</span><span class="o">=</span><span class="s">"scheme-documentation"</span><span class="p">&gt;</span>+<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> 2 4)<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>)<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>)<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
...
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-2"><i class="far fa-copy"></i></button></div>
</div>
</div>
<p>Something is going on with the class <code>paren</code>... Perhaps they use JavaScript to add the rainbow? But I searched for <code>js</code> in the source code and found nothing...</p>
<p>If it’s not JavaScript, then perhaps CSS? I saw <code>&lt;link rel="stylesheet" href="/css/default.css" type="text/css"&gt;</code> at the top of the file...</p>
<div class="filebox"><div class="filename">http://community.schemewiki.org/css/default.css</div>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149</pre>
</div>
</td><td class="code"><div class="source"><pre id="code-id-3"><span></span><span class="o">...</span>
<span class="c">/* The paren stuff */</span>

<span class="c">/* Top level */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#FFCFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 1 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFFFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 2 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFCFFF</span> <span class="p">}</span>

<span class="c">/* Paren level 3 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFFFFF</span> <span class="p">}</span>

<span class="c">/* Paren level 4 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#FFCFFF</span> <span class="p">}</span>

<span class="c">/* Paren level 5 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#FFFFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 6 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#B4E1EA</span> <span class="p">}</span>

<span class="c">/* Paren level 7 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#BDEAB4</span> <span class="p">}</span>

<span class="c">/* Paren level 8 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#EAD4B4</span> <span class="p">}</span>

<span class="c">/* Paren level 9 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#F4D0EC</span> <span class="p">}</span>

<span class="c">/* Paren level 10 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#D0D9F4</span> <span class="p">}</span>

<span class="c">/* Paren level 11 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#FFCFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 12 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFFFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 13 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFCFFF</span> <span class="p">}</span>

<span class="c">/* Paren level 14 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFFFFF</span> <span class="p">}</span>

<span class="c">/* Paren level 15 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#FFCFFF</span> <span class="p">}</span>

<span class="c">/* Paren level 16 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#FFFFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 17 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#BDEAB4</span> <span class="p">}</span>

<span class="c">/* Paren level 18 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#EAD4B4</span> <span class="p">}</span>

<span class="c">/* Paren level 19 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#F4D0EC</span> <span class="p">}</span>

<span class="c">/* Paren level 20 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#D0D9F4</span> <span class="p">}</span>

<span class="c">/* Paren level 21 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#FFCFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 22 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFFFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 23 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFFFCF</span> <span class="p">}</span>

<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">before</span> <span class="p">{</span> <span class="k">content</span><span class="p">:</span> <span class="s2">"{{23 levels of indentation?! Yiakes!}}"</span> <span class="p">}</span>

<span class="c">/* extend here if more nestings are needed */</span>
<span class="o">...</span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-3"><i class="far fa-copy"></i></button></div>
</div>
</div>
<p>Mystery solved!</p>
<h2>Integration with Pygments</h2>
<p>This rainbow trick requires that matching parentheses are grouped together in a <code>span</code>. The obvious method to achieve this is to use the <a href="https://docs.racket-lang.org/reference/Reading.html#%28def._%28%28quote._~23~25kernel%29._read%29%29"><code>read</code></a> function to transform string into an <a href="https://en.wikipedia.org/wiki/S-expression">S-Expression</a>, thereby grouping matching parentheses together. However, one complication is that I also use <a href="http://pygments.org/">Pygments</a> for syntax highlight. It’s not clear how to integrate all of these together. Let’s explore a couple of options:</p>
<ul>
<li>If we group parentheses first by using <code>read</code>, the output would be an S-expression. Pygments, which expects a string as an input, won’t be able to function. That means we need to manually highlight syntax... which seems really difficult.</li>
<li>If we use Pygments first, the output would be an <a href="https://docs.racket-lang.org/xml/index.html#%28def._%28%28lib._xml%2Fprivate%2Fxexpr-core..rkt%29._xexpr~3f%29%29">X-expression</a> representing an HTML DOM tree. <code>read</code>, which expects a string as an input, won’t be able to function. That means we need to manually extract and parse code from the tree. This is not trivial at all. For instance, it’s not clear how to distinguish between an actual left parenthesis and a left parenthesis as a string.</li>
</ul>
<p>However, one cool feature of Pygments is that it does not only do a syntax highlight but also acts as a lexer. Here’s an output example from Pygments:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-4"><span></span><span class="o">&#39;</span><span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"highlight"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">table</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"sourcetable"</span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="ss">tbody</span> <span class="paren"><span class="p">(</span><span class="ss">tr</span> <span class="paren"><span class="p">(</span><span class="ss">td</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"linenos"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"linenodiv"</span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="ss">pre</span> <span class="s2">" 1</span><span class="se">\n</span><span class="s2"> 2</span><span class="se">\n</span><span class="s2"> 3</span><span class="se">\n</span><span class="s2"> 4</span><span class="se">\n</span><span class="s2"> 5</span><span class="se">\n</span><span class="s2">..."</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">td</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"code"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"source"</span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="ss">pre</span> <span class="paren"><span class="p">(</span><span class="ss">span</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"kn"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"#lang "</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"nn"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"racket"</span><span class="p">)</span></span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span>
<span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"("</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"k"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"define-syntax-rule"</span><span class="p">)</span></span> <span class="s2">" "</span>
<span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"("</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"n"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"def"</span><span class="p">)</span></span> <span class="s2">" "</span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"n"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"whatever"</span><span class="p">)</span></span>
<span class="s2">" "</span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"k"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"..."</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">")"</span><span class="p">)</span></span> <span class="s2">" "</span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"("</span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"k"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"define"</span><span class="p">)</span></span> <span class="s2">" "</span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"n"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"whatever"</span><span class="p">)</span></span> <span class="s2">" "</span>
<span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"k"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"..."</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"))"</span><span class="p">)</span></span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"("</span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"k"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"define-syntax-rule"</span><span class="p">)</span></span> <span class="s2">" "</span> <span class="ss">...</span><span class="p">)</span></span> <span class="ss">...</span><span class="p">)</span></span> <span class="ss">...</span><span class="p">)</span></span> <span class="ss">...</span><span class="p">)</span></span> <span class="ss">...</span><span class="p">)</span></span> <span class="ss">...</span><span class="p">)</span></span> <span class="ss">...</span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-4"><i class="far fa-copy"></i></button></div>
</div>
<p>Notice that all parentheses are tagged with the class <code>p</code> properly, so the second approach looks really promising. But while this blob of data contains what we want, it’s not exactly a stream of tokens. To extract that out, we use a straightforward pattern matching<label for="margin-note-1" class="margin-note-toggle margin-note-number"></label><input type="checkbox" id="margin-note-1" class="margin-note-toggle"/><object class="margin-note"><div class="margin-note-box" decode="exclude-paragraph">And I thought, isn’t there jQuery for X-Expression? Then I found <a href="http://cs.brown.edu/~sk/Publications/Papers/Published/kk-sxslt/"><em>SXSLT: Manipulation Language for XML</em></a>... It’s not compatible with X-Expression though, so I didn’t use it.</div>
</object>:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-5"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="paren"><span class="p">(</span><span class="n">highlight</span> <span class="n">my-code-str</span><span class="p">)</span></span>
  <span class="paren"><span class="p">[</span><span class="o">`</span><span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"highlight"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">table</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"sourcetable"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">tbody</span> <span class="paren"><span class="p">(</span><span class="ss">tr</span>
  <span class="paren"><span class="p">(</span><span class="ss">td</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"linenos"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"linenodiv"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">pre</span> <span class="o">,</span><span class="n">linenos</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="ss">td</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"code"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"source"</span><span class="p">)</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="ss">pre</span> <span class="o">,</span><span class="n">things-in-pre</span> <span class="ss">...</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></span>
   <span class="o">`</span><span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"highlight"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">table</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"sourcetable"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">tbody</span> <span class="paren"><span class="p">(</span><span class="ss">tr</span>
   <span class="paren"><span class="p">(</span><span class="ss">td</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"linenos"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"linenodiv"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">pre</span> <span class="o">,</span><span class="n">linenos</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
   <span class="paren"><span class="p">(</span><span class="ss">td</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"code"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"source"</span><span class="p">)</span></span><span class="p">)</span></span>
     <span class="paren"><span class="p">(</span><span class="ss">pre</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"scheme"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="o">,@</span><span class="paren"><span class="p">(</span><span class="n">parenthesize</span> <span class="n">things-in-pre</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
   <span class="c1">; add class scheme to pre to make CSS works</span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-5"><i class="far fa-copy"></i></button></div>
</div>
<p>What we need to do next is to write a function <code>parenthesize</code> to match <code>(span ((class "p")) "(")</code> with <code>(span ((class "p")) ")")</code>. Note however that right now adjacent parentheses are grouped together, like <code>(span ((class "p")) "))")</code>. Therefore, we need to first normalize them by splitting them to multiple tokens: <code>(span ((class "p")) ")")</code> and <code>(span ((class "p")) ")")</code>.</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5
6
7</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-6"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span> <span class="paren"><span class="p">(</span><span class="n">normalize</span> <span class="n">lst</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">lst</span>
    <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span> <span class="o">`</span><span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="o">,</span><span class="n">str</span><span class="p">)</span></span> <span class="n">rst</span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span>
     <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._append))">append</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/map..rkt)._map))">map</a></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="o">`</span><span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="o">,</span><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string))">string</a></span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="nb">string-&gt;list</span> <span class="n">str</span><span class="p">)</span></span><span class="p">)</span></span>
             <span class="paren"><span class="p">(</span><span class="n">normalize</span> <span class="n">rst</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span>
    <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span> <span class="n">fst</span> <span class="n">rst</span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))">cons</a></span> <span class="n">fst</span> <span class="paren"><span class="p">(</span><span class="n">normalize</span> <span class="n">rst</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span>
    <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="n">lst</span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-6"><i class="far fa-copy"></i></button></div>
</div>
<p>After normalization, we now need to do the real work which is to parse and group matching parentheses together. There are obvious and efficient algorithms to do this, but I’ve heard that Racket’s pattern matching is pretty powerful, so let’s try that. The idea is to find an innermost matching parentheses and group them one at a time, then repeat until there is no more matching parentheses left.</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-7"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span> <span class="n">left-paren</span> <span class="o">&#39;</span><span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"("</span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span> <span class="n">right-paren</span> <span class="o">&#39;</span><span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">")"</span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span> <span class="n">not-paren?</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/procedures.html#(def._((lib._racket/function..rkt)._negate))">negate</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/procedures.html#(def._((lib._racket/function..rkt)._curryr))">curryr</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/base..rkt)._member))">member</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span> <span class="n">left-paren</span> <span class="n">right-paren</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span> <span class="paren"><span class="p">(</span><span class="n">iter</span> <span class="n">lst</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">lst</span>
    <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span> <span class="n">prefix-tok</span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span>
           <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))">==</a></span> <span class="n">left-paren</span><span class="p">)</span></span>
           <span class="paren"><span class="p">(</span><span class="n">?</span> <span class="n">not-paren?</span> <span class="n">inside</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span>
           <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))">==</a></span> <span class="n">right-paren</span><span class="p">)</span></span>
           <span class="n">suffix-tok</span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span>
     <span class="paren"><span class="p">(</span><span class="n">iter</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._append))">append</a></span> <span class="n">prefix-tok</span>
                   <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span> <span class="o">`</span><span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="ss">class</span> <span class="s2">"paren"</span><span class="p">]</span></span><span class="p">)</span></span>
                                <span class="o">,</span><span class="n">left-paren</span> <span class="o">,@</span><span class="n">inside</span> <span class="o">,</span><span class="n">right-paren</span><span class="p">)</span></span><span class="p">)</span></span>
                   <span class="n">suffix-tok</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span>
    <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="n">lst</span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-7"><i class="far fa-copy"></i></button></div>
</div>
<p>And finally define <code>parenthesize</code>:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-8"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span> <span class="n">parenthesize</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/procedures.html#(def._((lib._racket/private/list..rkt)._compose1))">compose1</a></span> <span class="n">iter</span> <span class="n">normalize</span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-8"><i class="far fa-copy"></i></button></div>
</div>
<p>And <em>holy cow, it works!</em> Pretty quickly, too. The exact time complexity is unclear since I do not exactly know how Racket’s magical pattern matching works. Note that the matching patterns are not static data, so the compiler would not be able to exploit this much. We can assume that the compiler will generate a dumb code to try to match things. Finding an innermost matching parentheses definitely takes at least linear time, and we repeat it until there’s no more matching parentheses. That is, the algorithm would be at least quadratic. Since the code in my blog would be at most 500 lines long, that’s pretty chill.</p>
<p>But we can improve this and make it linear time. There are several ways to do it. I came up with a stack-based solution, and <a href="http://justinpombrio.net">Justin</a> seems to like it:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-9"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span> <span class="n">left-thing?</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/procedures.html#(def._((lib._racket/function..rkt)._curryr))">curryr</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/base..rkt)._member))">member</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span> <span class="n">left-paren</span> <span class="n">left-bracket</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))">define</a></span> <span class="n">right-thing?</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/procedures.html#(def._((lib._racket/function..rkt)._curryr))">curryr</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/base..rkt)._member))">member</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span> <span class="n">right-paren</span> <span class="n">right-bracket</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((quote._~23~25kernel)._define-values))">define-values</a></span> <span class="paren"><span class="p">(</span><span class="n">parsed-flipped</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for/fold))">for/fold</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">stack</span> <span class="o">&#39;</span><span class="paren"><span class="p">(</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">e</span> <span class="paren"><span class="p">(</span><span class="n">normalize</span> <span class="n">lst</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">e</span>
      <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="n">?</span> <span class="n">left-thing?</span> <span class="n">lp</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))">values</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))">cons</a></span> <span class="n">lp</span> <span class="n">stack</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span>
      <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="n">?</span> <span class="n">right-thing?</span> <span class="n">rp</span><span class="p">)</span></span>
       <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((quote._~23~25kernel)._define-values))">define-values</a></span> <span class="paren"><span class="p">(</span><span class="n">grouped</span> <span class="n">new-stack</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/list..rkt)._splitf-at))">splitf-at</a></span> <span class="n">stack</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/procedures.html#(def._((lib._racket/function..rkt)._negate))">negate</a></span> <span class="n">left-thing?</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
       <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))">values</a></span>
         <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">new-stack</span>
           <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span> <span class="paren"><span class="p">(</span><span class="n">?</span> <span class="n">left-thing?</span> <span class="n">lp</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span>
            <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span> <span class="n">lp</span> <span class="n">rp</span><span class="p">)</span></span>
              <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))">==</a></span> <span class="n">left-paren</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))">==</a></span> <span class="n">right-paren</span><span class="p">)</span></span><span class="p">)</span></span> <span class="no">#f</span><span class="p">]</span></span>
              <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))">==</a></span> <span class="n">left-bracket</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))">==</a></span> <span class="n">right-bracket</span><span class="p">)</span></span><span class="p">)</span></span> <span class="no">#f</span><span class="p">]</span></span>
              <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._error))">error</a></span> <span class="o">&#39;</span><span class="ss">mismatched-type-paren</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
            <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))">cons</a></span> <span class="o">`</span><span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="ss">class</span> <span class="s2">"paren"</span><span class="p">]</span></span><span class="p">)</span></span>
                         <span class="o">,@</span><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/list..rkt)._reverse))">reverse</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._append))">append</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span> <span class="n">rp</span><span class="p">)</span></span> <span class="n">grouped</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))">list</a></span> <span class="n">lp</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
                  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/list..rkt)._rest))">rest</a></span> <span class="n">new-stack</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span>
           <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))">cons</a></span> <span class="n">e</span> <span class="n">stack</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span> <span class="c1">; if too many right parentheses</span>
      <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))">values</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))">cons</a></span> <span class="n">e</span> <span class="n">stack</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/list..rkt)._reverse))">reverse</a></span> <span class="n">parsed-flipped</span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-9"><i class="far fa-copy"></i></button></div>
</div>
<p>This algorithm also tolerates mismatched parentheses (but not mismatch type). This is great because it’s possible that I will just copy and paste only a part of a code from somewhere else, which doesn’t have complete matching parentheses.</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-10"><span></span><span class="c1">; this has too many right parentheses</span>
<span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))">cons</a></span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span></span><span class="err">)</span>
<span class="c1">; this has too many left parentheses</span>
<span class="p">(</span><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))">cons</a></span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-10"><i class="far fa-copy"></i></button></div>
</div>
<p>And this is how I get rainbow parentheses on my site. <i class="em em-smiley"></i></p>
</div>
</p>
</div>
</div>
<footer><hr/><div class="float-md-left">Site generated by <a href="http://pollenpub.com">Pollen</a>/<a href="https://racket-lang.org">Racket</a></div>
<div class="float-md-right">© Sorawee Porncharoenwase</div>
</footer>
</main>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script src="https://homes.cs.washington.edu/~sorawee/static/js/bootstrap.bundle.min.js"></script><script src="https://homes.cs.washington.edu/~sorawee/static/js/script.js"></script></body>
</html>