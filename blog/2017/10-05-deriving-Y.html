
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Deriving the Y Combinator (Part 1)</title>
    <meta name="author"      content="Sorawee Porncharoenwase">
    <meta name="keywords"    content="<!-- TODO -->">
    <meta name="viewport"    content="width=device-width, initial-scale=1.0">
    <link rel="icon"      href="https://homes.cs.washington.edu/~sorawee/favicon.ico">
    <link rel="canonical" href="<!-- TODO -->">

    <!-- TODO -->


    <!-- CSS -->
    <link rel="stylesheet" href="https://code.cdn.mozilla.net/fonts/fira.css">
    <link rel="stylesheet" href="https://afeld.github.io/emoji-css/emoji.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://homes.cs.washington.edu/~sorawee/css/app.css">
    <link rel="stylesheet" type="text/css" href="https://homes.cs.washington.edu/~sorawee/css/pygments.css">
    <link rel="stylesheet" type="text/css" href="https://homes.cs.washington.edu/~sorawee/css/scribble.css">

    <!-- TODO: Feeds -->

    <!-- TODO: Google Analytics -->
  </head>
  <body>

    <!-- A standard Twitter Bootstrap nav bar -->
    <nav class="navbar navbar-expand-md navbar-light bg-light">
      <div class="container">
        <div class="navbar-brand site-info">
          <h1>
            <a href="https://homes.cs.washington.edu/~sorawee/index.html">Sorawee Porncharoenwase</a>
          </h1>
          <p>PhD Student at UW CSE</p>
        </div>

        <button class="navbar-toggler navbar-toggler-right"
                type="button" data-toggle="collapse"
                data-target="#navbar_collapse" aria-controls="navbar_collapse"
                aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbar_collapse">
          <ul class="navbar-nav ml-auto"><li class="nav-item "><a class="nav-link" href="https://homes.cs.washington.edu/~sorawee/index.html">Home</a></li><li class="nav-item "><a class="nav-link" href="https://homes.cs.washington.edu/~sorawee/blog">Blog</a></li><li class="nav-item"><a class="nav-link" title="sorawee@cs.washington.edu" href="mailto:sorawee@cs.washington.edu" data-toggle="tooltip" data-placement="bottom"><i class="fas fa-envelope"></i></a></li><li class="nav-item"><a class="nav-link" title="CSE 394" href="https://norfolk.cs.washington.edu/directory/index.php?prev_floor=3&amp;show_room=CSE394" data-toggle="tooltip" data-placement="bottom"><i class="fas fa-map-marker-alt"></i></a></li><li class="nav-item"><a class="nav-link" title="@sorawee" href="https://www.github.com/sorawee" data-toggle="tooltip" data-placement="bottom"><i class="fab fa-github"></i></a></li><li class="nav-item"><a class="nav-link" title="Pollen source" href="https://github.com/sorawee/my-website/blob/master/blog/2017/10-05-deriving-Y.poly.pm" data-toggle="tooltip" data-placement="bottom"><i class="fas fa-code"></i></a></li></ul>
        </div>
      </div>
    </nav>

    <main class="container">
      <div id="content-title--blog-2017-10-05-deriving-Y-html"
           class="row content-type--post">
        <!-- Main column -->
        <div><h1>Deriving the Y Combinator (Part 1)</h1><p><span class="pubdate">Published on Thursday, October 5th, 2017</span> :: <span><a href="https://homes.cs.washington.edu/~sorawee/tags/programming-languages">programming-languages</a>, <a href="https://homes.cs.washington.edu/~sorawee/tags/y-combinator">y-combinator</a>, <a href="https://homes.cs.washington.edu/~sorawee/tags/DRAFT">DRAFT</a></span></p><p class="update"><span class="pubdate">Updated on Wednesday, November 21st, 2018</span></p><div class="post-content"><p>Several people have been trying to explain the idea of the Y combinator. I feel these explanations are somewhat unsatisfactory. Some explanations start by writing down the combinator in the beginning, and then simply demonstrate that the given combinator is correct. Some other explanations contain lines like “Why don’t we try passing it to itself? And look, this turns out to be exactly what we want!” These explanations don’t give an intuition for how one could <em>constructively</em> obtain the combinator. <em>What on earth makes you think that passing it to itself is a good idea?</em> As such, this post attempts to explain how one could constructively derive the Y combinator.</p><p><see-more></see-more></p><h2>Introduction</h2><p>In <a href="https://en.wikipedia.org/wiki/Lambda_calculus">lambda calculus</a>, there’s no primitive support to define recursive functions. The central problem that we will attempt to solve is, <em>how can we define recursive functions in lambda calculus?</em></p><p>In this post, we will use Racket instead of lambda calculus. The choice of Racket is that:</p><ul><li>It is an actual programming language, so it has an interpreter that we can use to actually run our code.</li><li>It has a support for primitive values like numbers, unlike lambda calculus, whose only possible values are lambda functions, which would make it unnecessarily difficult to follow.</li><li>It is not statically typed, so we can write the combinator which would have been prohibited had we use a language with a standard type system like <a href="https://en.wikipedia.org/wiki/Hindley%E2%80%93Milner_type_system">Hindley–Milner</a>.</li><li>Its semantics is close to lambda calculus. Unlike, say, JavaScript and Python, there’s no variable hoisting, so we won’t face a problem where a simple, innocent assignment <code>const f = () =&gt; f();</code> unintentionally allows recursion.</li></ul><p>Alright, let’s now begin!</p><h2>Enabling recursion</h2><p>In Racket, we can write code to compute <mathjax>$3! + 4!$</mathjax> easily.</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._letrec))">letrec</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                 <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                   <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                   <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="c1">; =&gt; 30</span>
</pre></div></td></tr></tbody></table></div><p>Defining this recursive <code>fact</code> function is possible because <code>letrec</code> allows us to refer to <code>fact</code> inside the lambda function that <em>will</em> be <code>fact</code> itself. Formally, the semantics of <code>(letrec ([⟪x⟫ ⟪v⟫] ⟪e⟫))</code> is the following:</p><ol><li>Create a location for <code>⟪x⟫</code> and add it to the environment<label for="margin-note-1" class="margin-note-toggle margin-note-number"></label><input type="checkbox" id="margin-note-1" class="margin-note-toggle"/><span class="margin-note">There are a lot of variants for this step. Racket does not initialize the location with any content, so <code>(letrec ([x x]) 0)</code> will result in an error because <code>x</code> is uninitilized. Ruby, whose <code>=</code> is roughly equivalent to <code>letrec</code>, initializes the location with <code>nil</code>, so <code>x = x</code> assigns <code>nil</code> to <code>x</code>.</span>.</li><li>Evaluate <code>⟪v⟫</code> with the above environment, and put the evaluation result in the location (that is, <em>mutate</em> <code>⟪x⟫</code> to <code>⟪v⟫</code>).</li><li>Evaluate <code>⟪e⟫</code> with the above environment, and return its evaluation result.</li></ol><p>Of course, lambda calculus has neither <code>letrec</code> nor mutation. To simulate lambda calculus, we will attempt to write the factorial function in Racket without using <code>letrec</code> and mutation. Here’s our first straightforward attempt:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="highlight-focus"><span class="n">fact</span></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="c1">;; =&gt; fact: unbound identifier in: fact</span>
</pre></div></td></tr></tbody></table></div><p>We simply change <code>letrec</code> to <code>let</code>, where <code>(let ([⟪x⟫ ⟪v⟫]) ⟪e⟫)</code>’s semantics is:</p><ol><li>Evaluate <code>⟪v⟫</code>.</li><li>Create a location for <code>⟪x⟫</code> and initialize the location with the evaluation result of <code>⟪v⟫</code>, and then add it to the environment.</li><li>Evaluate <code>⟪e⟫</code> with the above environment, and return its evaluation result.</li></ol><p>Although <code>(let ([⟪x⟫ ⟪v⟫]) ⟪e⟫)</code> and <code>(letrec ([⟪x⟫ v]) ⟪e⟫)</code> are very similar, <code>let</code> doesn’t have the ability that allows us to refer to <code>⟪x⟫</code> in <code>⟪v⟫</code>. In fact, <code>let</code> doesn’t add any expressive power to lambda calculus at all because its semantics is completely equivalent to <code>((λ (⟪x⟫) ⟪e⟫) ⟪v⟫)</code>, a lambda term, whose semantics is completely the same as <code>(let ([⟪x⟫ ⟪v⟫]) ⟪e⟫)</code>. Some programming languages simply treats <code>let</code> as a <a href="https://en.wikipedia.org/wiki/Syntactic_sugar">syntactic sugar</a>, and desugar <code>(let ([⟪x⟫ ⟪v⟫]) ⟪e⟫)</code> to <code>((λ (⟪x⟫) ⟪e⟫) ⟪v⟫)</code>.</p><p>Our first straightforward attempt doesn’t work because the highlighted <code>fact</code> is unbound inside the lambda function<label for="margin-note-2" class="margin-note-toggle margin-note-number"></label><input type="checkbox" id="margin-note-2" class="margin-note-toggle"/><span class="margin-note">assuming that <a href="https://en.wikipedia.org/wiki/Scope_(computer_science)#Lexical_scope_vs._dynamic_scope">lexical scope</a> (which is what lambda calculus uses) is used.</span>.</p><p>How can we fix it? Let’s take a look at another example:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="n">n</span> <span class="highlight-focus"><span class="n">c</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">c</span> <span class="mi">1</span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="mi">99</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="c1">;; =&gt; c: unbound identifier in: c</span>
</pre></div></td></tr></tbody></table></div><p>The above code has a similar problem. <code>c</code> is unbound inside the body of the lambda. One way to fix the problem is to explicitly pass <code>c</code> to the lambda function, so that <code>c</code> is bound:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">[</span><span class="paren"><span class="p">[</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="highlight-add"><span class="n">c</span></span> <span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="n">n</span> <span class="n">c</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">]</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">[</span><span class="paren"><span class="p">[</span><span class="n">c</span> <span class="mi">1</span><span class="p">]</span></span><span class="p">]</span></span>
    <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="highlight-add"><span class="n">c</span></span> <span class="mi">99</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="c1">;; =&gt; 100</span>
</pre></div></td></tr></tbody></table></div><p>Our solution to the unbound <code>fact</code> problem is going to be the same. While <code>fact</code> is unbound inside the lambda function, it is bound in the body of <code>let</code>, so we can give <code>fact</code> explicitly to the lambda function!</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="highlight-add"><span class="n">fact</span></span> <span class="n">n</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="highlight-focus"><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="highlight-add"><span class="n">fact</span></span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="highlight-add"><span class="n">fact</span></span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="c1">;; =&gt; fact: arity mismatch;</span>
<span class="c1">;; the expected number of arguments does not match the given number</span>
<span class="c1">;;  expected: 2</span>
<span class="c1">;;  given: 1</span>
<span class="c1">;;  arguments...:</span>
</pre></div></td></tr></tbody></table></div><p>There’s still a problem: <code>fact</code> is now a function of arity 2, so the highlighted function application would result in an arity mismatch error. What does <code>fact</code> need as the first argument? The answer is <code>fact</code>! So we can fix the code accordingly:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">n</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="highlight-add"><span class="n">fact</span></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="c1">;; =&gt; 30</span>
</pre></div></td></tr></tbody></table></div><p>As expected, the program now produces a correct answer!</p><p>With this trick, we can write any recursive function in a language without <code>letrec</code> by the following method:</p><ol><li>Initially write the recursive function <mathjax>$f$</mathjax> with <code>letrec</code>.</li><li>Change <code>letrec</code> to the <code>let</code>.</li><li>At every callsite of <mathjax>$f$</mathjax>, prepend the arguments with <mathjax>$f$</mathjax>’s name</li><li>Prepend the parameters of <mathjax>$f$</mathjax> with <mathjax>$f$</mathjax>’s name</li></ol><p>This is simply a syntax transformation which could be done programmatically.</p><h2>Omega</h2><p>Let’s digress a little bit here. What will happen if we perform the syntax transformation to the stupid infinite loop function?</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._letrec))">letrec</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">diverge</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">diverge</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="n">diverge</span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>is transformed to:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">diverge</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">diverge</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">diverge</span> <span class="n">diverge</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="n">diverge</span> <span class="n">diverge</span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>To obtain a lambda term, we simply desugar <code>let</code> as described above:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">diverge</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">diverge</span> <span class="n">diverge</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">diverge</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">diverge</span> <span class="n">diverge</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>Recall that this is known as the <mathjax>$\Omega$</mathjax>-combinator, a classic example of a lambda term whose evaluation doesn’t terminate.</p><h2>Deriving the fake Y combinator</h2><p>Now, back to the main topic, the question that we should ask next is, are we satisfied with our way to write an arbitrary recursive function? Some people are not because the transformed function doesn’t look like the original function that we would write in the <code>letrec</code> version. It would be nice if there exists a term <code>⟪make-recursion-possible⟫</code> such that:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="n">⟪make-recursion-possible⟫</span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
    <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
    <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="highlight-focus"><span class="n">fact</span></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span>

<span class="paren"><span class="p">(</span><span class="n">⟪make-recursion-possible⟫</span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
    <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">0</span><span class="p">]</span></span>
    <span class="paren"><span class="p">[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">]</span></span>
    <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="highlight-focus"><span class="n">fib</span></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="highlight-focus"><span class="n">fib</span></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">2</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span>

<span class="paren"><span class="p">(</span><span class="n">⟪make-recursion-possible⟫</span>
  <span class="n">⟪body-of-any-recursive-function⟫</span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>produces the actual factorial function, the actual Fibonacci function, and the actual recursive function respectively.</p><p>However, this doesn’t quite work, because the highlighted identifiers are unbound regardless of what <code>⟪make-recursion-possible⟫</code> is. So we will change our goal to:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="n">⟪make-recursion-possible⟫</span>
  <span class="paren"><span class="p">(</span><span class="highlight-add"><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span></span>
    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
      <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
      <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>

<span class="paren"><span class="p">(</span><span class="n">⟪make-recursion-possible⟫</span>
  <span class="paren"><span class="p">(</span><span class="highlight-add"><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fib</span><span class="p">)</span></span></span>
    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
      <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">0</span><span class="p">]</span></span>
      <span class="paren"><span class="p">[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">]</span></span>
      <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fib</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fib</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">2</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>

<span class="paren"><span class="p">(</span><span class="n">⟪make-recursion-possible⟫</span>
  <span class="paren"><span class="p">(</span><span class="highlight-add"><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">⟪any-recursive-function-name⟫</span><span class="p">)</span></span></span>
    <span class="n">⟪any-recursive-function-body⟫</span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>By wrapping the recursive function body in the lambda function, the identifiers are now bound. We will call <code>(λ (⟪any-recursive-function-name⟫) ⟪any-recursive-function-body⟫)</code> a <em>recursion maker</em>. And what we want is that for any <code>⟪recursion-maker⟫</code>, <code>(⟪make-recursion-possible⟫ ⟪recursion-maker⟫)</code> should produce the actual recursive function.</p><p>How should we approach this? We don’t know what <code>⟪make-recursion-possible⟫</code> looks like. But for the factorial function, we do know what <code>⟪fact-maker⟫</code> looks like. The strategy, then, is to extract the <code>⟪fact-maker⟫</code>:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
    <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
    <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>from our current code:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">n</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>Hopefully, what’s left is going to be <code>⟪make-recursion-possible⟫</code><label for="margin-note-3" class="margin-note-toggle margin-note-number"></label><input type="checkbox" id="margin-note-3" class="margin-note-toggle"/><span class="margin-note">Alternatively, we might think that <code>⟪make-recursion-possible⟫</code> + <code>⟪fact-maker⟫</code> = <code>⟪fact⟫</code>. By extracting <code>⟪fact-maker⟫</code> from <code>⟪fact⟫</code>, we wish that we will have <code>⟪make-recursion-possible⟫</code> = <code>⟪fact⟫</code> - <code>⟪fact-maker⟫</code> as a leftover.</span>.</p><p>As a first step, we can avoid prepending <code>fact</code> at the callsites of <code>fact</code> inside the lambda function. Simply transform:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">n</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>to</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">n</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
                <span class="highlight-focus"><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                  <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                  <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>which shadows <code>fact</code> that consumes two arguments with <code>fact</code> that consumes one argument while maintaining the semantics.</p><p>The body of the function is now very similar to <code>⟪fact-maker⟫</code>, especially for the highlighted part. What can we do next? We see that <code>fact</code> and <code>n</code> are both the formal parameters in the transformed code, whereas in <code>⟪fact-maker⟫</code> they are separated. Straightforwardly, we can use <a href="https://en.wikipedia.org/wiki/Currying">currying</a> to separate the two apart. We of course need to change how we call the function as well:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
                  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                    <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                    <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>The <code>(let ([fact (λ (n) ((fact fact) n))]) ...)</code> doesn’t depend on the parameter <code>n</code>, so we can lift it up without changing the semantics:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
                <span class="highlight-focus"><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                    <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                    <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>Now our highlighted code is very similar to the <code>⟪fact-maker⟫</code>! What we want to do next is to somehow convert <code>(let ([fact ...]) body...)</code> into <code>(λ (fact) body...)</code> and move <code>(λ (n) ((fact fact) n))</code> somewhere else. How can we do that?<br/>.<br/>.<br/>.</p><p>That’s simply desugaring <code>let</code>!</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="highlight-focus"><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
                 <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                   <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                     <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                     <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></span>
               <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>and we finally have the <code>⟪fact-maker⟫</code>!</p><p>Our next mission is to obtain the <code>⟪make-recursion-possible⟫</code>. To make things tidy, let’s first abstract <code>⟪fact-maker⟫</code> out as a variable named <code>fact-maker</code>:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
                    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                      <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                        <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                        <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>Recall that <code>(⟪make-recursion-possible⟫ fact-maker)</code> should produce the actual factorial function which consumes only one number as an argument. Right now we still have <code>((fact fact) 3)</code> and <code>((fact fact) 4)</code> in the innermost body as a result of prependingt argument list. We can fix this using the same transformation that we did earlier:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
                    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                      <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                        <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                        <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
      <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>As we want a single term for <code>⟪make-recursion-possible⟫</code>, we probably don’t want nested <code>let</code>, so we will fuse them together in a straightforward way:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
                    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                      <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                        <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                        <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
               <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>As a final step, <code>⟪make-possible-recursion⟫</code> should consume <code>fact-maker</code> as an argument, so we can abstract <code>fact-maker</code> out:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
                    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                      <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                        <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                        <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span><span class="p">)</span></span>
                 <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
                  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
               <span class="n">fact-maker</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>And we are done! We have derived the <code>⟪make-recursion-possible⟫</code> as follows:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
   <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>Notice that there’s nothing inherent about the factorial function here. If we use the Fibonacci function as a starting point, we would end up with a term that is <a href="https://en.wikipedia.org/wiki/Lambda_calculus#Alpha_equivalence"><mathjax>$\alpha$</mathjax>-equivalent</a> to this <code>⟪make-recursion-possible⟫</code> as well. We will highlight this fact by <mathjax>$\alpha$</mathjax>-convert variable names to remove all references to the factorial function:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">f</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">v</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span> <span class="n">v</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
   <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">v</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span> <span class="n">v</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>This <code>⟪make-recursion-possible⟫</code> is formally called the <em>Z combinator</em>, and we will subsequently call it <mathjax>$Z$</mathjax>. It is one of the well-known <em>fixed-point combinator</em>s. The word <em>combinator</em> means that there’s no free variable in <mathjax>$Z$</mathjax>. The word <em>fixed-point</em> means that <mathjax>$Z(f)$</mathjax> is a solution to the equation <mathjax>$k = f(k)$</mathjax> for any function <mathjax>$f$</mathjax>. That is, <mathjax>$Z(f) = f(Z(f))$</mathjax>. Note that we can keep continue going, and we will obtain <mathjax>$Z(f) = f(Z(f)) = f(f(Z(f))) = f(f(f(Z(f)))) = \dots$</mathjax>. In our example <code>Z(fact-maker)</code> is equivalent to <code>fact-maker(fact-maker(fact-maker(...)))</code>. We will investigate what this means in the next post.</p><p>Recall that the title of this section is <em>Deriving the fake Y combinator</em>. It’s fake because we actually derived the Z combinator, not the Y combinator. However, they are essentially the same. The difference of the two combinators will also be covered in the next post.</p><p>Here’s our final code:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">Z</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">f</span><span class="p">)</span></span>
           <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">v</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span> <span class="n">v</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
            <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">v</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span> <span class="n">v</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
                      <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                        <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                          <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span></span>
                          <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="n">Z</span> <span class="n">fact-maker</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
      <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="c1">;; =&gt; 30</span>
</pre></div></td></tr></tbody></table></div><h2>Y and Me</h2><p>Personally, I know the Y combinator for almost two years now from the <a href="https://cs.brown.edu/courses/cs173/">PL class</a> taught by <a href="https://cs.brown.edu/~sk/">Shriram Krishnamurthi</a>. One great explanation I know (which Shriram pointed out to) is Matthias Felleisen’s <a href="https://xivilization.net/~marek/binaries/Y.pdf"><i>A Lecture of the Why of Y</i></a>, which similarly attempts to derive the Y combinator. However, the explanation that corresponds to the “Enabling recursion” section is a lot slower: it started by defining a series of functions <mathjax>$\set{f_i}$</mathjax> where <mathjax>$f_i$</mathjax> is the factorial function that works on input less than or equal to <mathjax>$i$</mathjax>, then abstracted out common patterns, and then performed the “self-application” trick. A strength of this approach is that it crucially uses the fixed-point identity <mathjax>$Y(f) = f(Y(f))$</mathjax> to justify the self-application trick in the derivation, so it motivates really well why <mathjax>$Y(f) = f(Y(f))$</mathjax> is important. The approach that I use, on the other hand, simply focuses on where things are bound and how do we direct values to appropriate places, which results in a simpler explanation in my opinion. I also make use of <code>let</code> a lot, which I think helps a lot with readability, with the weakness being that I also need to talk about desugaring.</p><p>Of course, I didn’t discover this approach myself. I obtained the insight of the approach this semester when I graded a student’s homework in the <a href="https://cs.brown.edu/courses/cs173/2017/">current iteration</a> of the PL class. A part of the homework asks students to write random programs in a language that is very similar to Racket without <code>letrec</code> and mutation. I didn’t expect that students will be able to write a really meaningful program unless they know a fixed-point combinator already, ... or so I thought. It turns out that one student wrote a program to calculate 1 + 2 + ... + n for arbitrary n without knowing a fixed-point combinator! Here’s the program in Racket:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">triangle</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">triangle</span> <span class="n">n</span><span class="p">)</span></span>
                  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))">match</a></span> <span class="n">n</span>
                    <span class="paren"><span class="p">[</span><span class="mi">0</span> <span class="mi">0</span><span class="p">]</span></span>
                    <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))">_</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">triangle</span> <span class="n">triangle</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="n">triangle</span> <span class="n">triangle</span> <span class="mi">10</span><span class="p">)</span></span><span class="p">)</span></span>
<span class="c1">;; =&gt; 55</span>
</pre></div></td></tr></tbody></table></div><p>Granted, this is simply a rewrite of one of Matthias’s slides into the <code>let</code> form, but it really strikes me.</p><p>Since our grading policy dictates that we can’t look at students’ name, I don’t know who this student is. Regardless, I would like to thank him/her here for this incredible insight.</p></div></div>
      </div>
      <footer>
        <hr />
        <div class="float-md-left">
          Site generated by <a href="http://pollenpub.com">
            Pollen
          </a>/<a href="https://racket-lang.org">
            Racket
          </a>
        </div>
        <div class="float-md-right">
          © Sorawee Porncharoenwase
        </div>
      </footer>
    </main>
    <!-- JS -->
    <script type="text/javascript" src="https://homes.cs.washington.edu/~sorawee/js/jquery-3.2.1.slim.min.js"></script>
    <script type="text/javascript" src="https://homes.cs.washington.edu/~sorawee/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <script type="text/javascript" src="https://homes.cs.washington.edu/~sorawee/js/script.js"></script>
  </body>
</html>