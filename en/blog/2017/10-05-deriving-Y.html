<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"/><title>Deriving the Y Combinator</title><meta name="author" content="Sorawee Porncharoenwase"/><meta name="keywords" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="icon" href="https://homes.cs.washington.edu/~sorawee/static/favicon.ico"/><link rel="canonical" href=""/><link rel="stylesheet" type="text/css" href="https://afeld.github.io/emoji-css/emoji.css"/><link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"/><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Sarabun"/><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Source+Code+Pro"/><link rel="stylesheet" type="text/css" href="https://homes.cs.washington.edu/~sorawee/static/css/app.css"/><link rel="stylesheet" type="text/css" href="https://homes.cs.washington.edu/~sorawee/static/css/pygments.css"/><link rel="alternate" type="application/atom+xml" href="https://homes.cs.washington.edu/~sorawee/en/feed.xml"/></head>
<body><nav class="navbar navbar-expand-md navbar-light bg-light"><div class="container"><div class="navbar-brand site-info">
<h1><a href="https://homes.cs.washington.edu/~sorawee/en/index.html">Sorawee Porncharoenwase</a></h1>
<p>PhD Student at UW CSE</p>
</div>
<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbar_collapse" aria-controls="navbar_collapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbar_collapse"><ul class="navbar-nav ml-auto"><li class="nav-item "><a class="nav-link" href="https://homes.cs.washington.edu/~sorawee/en/index.html">Home</a></li>
<li class="nav-item "><a class="nav-link" href="https://homes.cs.washington.edu/~sorawee/en/blog">Blog</a></li>
<li class="nav-item "><a class="nav-link" href="https://homes.cs.washington.edu/~sorawee/en/coq-tactics">Coq&#160;Tactics<sup>&lt;α</sup></a></li>
<li class="nav-item"><a class="nav-link" title="sorawee@cs.washington.edu" href="mailto:sorawee@cs.washington.edu" data-toggle="tooltip" data-placement="bottom"><i class="fas fa-envelope"></i></a></li>
<li class="nav-item"><a class="nav-link" title="CSE 394" href="https://norfolk.cs.washington.edu/directory/index.php?prev_floor=3&amp;show_room=CSE394" data-toggle="tooltip" data-placement="bottom"><i class="fas fa-map-marker-alt"></i></a></li>
<li class="nav-item"><a class="nav-link" title="@sorawee" href="https://www.github.com/sorawee" data-toggle="tooltip" data-placement="bottom"><i class="fab fa-github"></i></a></li>
<li class="nav-item"><a class="nav-link" title="Pollen source" href="https://github.com/sorawee/my-website/blob/master/blog/2017/10-05-deriving-Y.html.pm" data-toggle="tooltip" data-placement="bottom"><i class="fas fa-code"></i></a></li>
<li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-language"></i></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item disabled" href="https://homes.cs.washington.edu/~sorawee/en/blog/2017/10-05-deriving-Y.html">English</a><a class="dropdown-item " href="https://homes.cs.washington.edu/~sorawee/th/blog/2017/10-05-deriving-Y.html">Thai</a></div>
</li>
</ul>
</div>
</div>
</nav>
<main class="container"><div id="content-title--blog-2017-10-05-deriving-Y-html" class="row content-type--post">
<div>
<h1>Deriving the Y Combinator</h1>
<p>
<p><span class="pubdate">Published on Thursday, October 5th, 2017</span> :: <span><a href="https://homes.cs.washington.edu/~sorawee/en/tags/programming-languages">programming-languages</a>, <a href="https://homes.cs.washington.edu/~sorawee/en/tags/y-combinator">y-combinator</a></span></p>
<p class="update"><span class="pubdate">Updated on Sunday, December 9th, 2018</span></p>
<div class="post-content">
<h2></h2>
<h2></h2>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5
6
7</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-1"><span></span><span class="kn">#lang </span><span class="nn">racket</span>

<span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._letrec))">letrec</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                 <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                   <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                   <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-1"><i class="far fa-copy"></i></button></div>
</div>
<div class="highlight-container"><div class="highlight"><pre id="output-id-1">30</pre>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#output-id-1"><i class="far fa-copy"></i></button></div>
</div>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-2"><span></span><span class="paren"><span class="p">(</span><mark class="highlight-add"><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span></mark> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><mark class="highlight-focus"><span class="n">fact</span></mark> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-2"><i class="far fa-copy"></i></button></div>
</div>
<div class="highlight-container"><div class="highlight"><pre id="output-id-2"><span class="text-type-error">fact: unbound identifier in: fact</span></pre>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#output-id-2"><i class="far fa-copy"></i></button></div>
</div>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-3"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="n">n</span> <mark class="highlight-focus"><span class="n">c</span></mark><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">c</span> <span class="mi">1</span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="mi">99</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-3"><i class="far fa-copy"></i></button></div>
</div>
<div class="highlight-container"><div class="highlight"><pre id="output-id-3"><span class="text-type-error">c: unbound identifier in: c</span></pre>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#output-id-3"><i class="far fa-copy"></i></button></div>
</div>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-4"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><mark class="highlight-add"><span class="n">c</span></mark> <span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="n">n</span> <span class="n">c</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">c</span> <span class="mi">1</span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="n">f</span> <mark class="highlight-add"><span class="n">c</span></mark> <span class="mi">99</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-4"><i class="far fa-copy"></i></button></div>
</div>
<div class="highlight-container"><div class="highlight"><pre id="output-id-4">100</pre>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#output-id-4"><i class="far fa-copy"></i></button></div>
</div>
<p>Our solution to the unbound <code>fact</code> problem is going to be the same. While <code>fact</code> is unbound inside the lambda function, it is bound in the body of <code>let</code>, so we can pass <code>fact</code> explicitly to the lambda function!</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-5"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><mark class="highlight-add"><span class="n">fact</span></mark> <span class="n">n</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span></mark><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <mark class="highlight-add"><span class="n">fact</span></mark> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <mark class="highlight-add"><span class="n">fact</span></mark> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-5"><i class="far fa-copy"></i></button></div>
</div>
<div class="highlight-container"><div class="highlight"><pre id="output-id-5"><span class="text-type-error">fact: arity mismatch;
the expected number of arguments does not match the given number
 expected: 2
 given: 1
 arguments...:</span></pre>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#output-id-5"><i class="far fa-copy"></i></button></div>
</div>
<p>There’s still a problem: <code>fact</code> is now a function of arity 2, so the highlighted function application would result in an arity mismatch error. What does <code>fact</code> need as the first argument? The answer is <code>fact</code>! So we can fix the code accordingly:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-6"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">n</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <mark class="highlight-add"><span class="n">fact</span></mark> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-6"><i class="far fa-copy"></i></button></div>
</div>
<div class="highlight-container"><div class="highlight"><pre id="output-id-6">30</pre>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#output-id-6"><i class="far fa-copy"></i></button></div>
</div>
<p>With this trick, we can write any recursive function in a language without <code>letrec</code> by the following method:</p>
<ol>
<li>Initially write the recursive function $f$ with <code>letrec</code>.</li>
<li>Change <code>letrec</code> to the <code>let</code>.</li>
<li>At every callsite of $f$, prepend the arguments with $f$’s name</li>
<li>Prepend the parameters of $f$ with $f$’s name</li>
</ol>
<p>This is simply a syntax transformation which could be done mechanically.</p>
<h2>Omega</h2>
<p>Let’s digress a little bit here. What will happen if we perform the syntax transformation to this function which loops forever?</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-7"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._letrec))">letrec</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">diverge</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">diverge</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="n">diverge</span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-7"><i class="far fa-copy"></i></button></div>
</div>
<p>is transformed to:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-8"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">diverge</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">diverge</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">diverge</span> <span class="n">diverge</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="n">diverge</span> <span class="n">diverge</span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-8"><i class="far fa-copy"></i></button></div>
</div>
<p>To obtain a lambda term, we simply desugar <code>let</code> as described above:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-9"><span></span><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">diverge</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">diverge</span> <span class="n">diverge</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">diverge</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">diverge</span> <span class="n">diverge</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-9"><i class="far fa-copy"></i></button></div>
</div>
<p>Recall that this is known as the $\Omega$-combinator, a classic example of a lambda term whose evaluation doesn’t terminate.</p>
<h2>Deriving a fake Y combinator</h2>
<p>While we now know how to write recursive functions in lambda calculus, the transformed function doesn’t look like the original function that we would write in the <code>letrec</code> version. It would be nice if there is a term <code>‹make-recursion›</code> such that:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-10"><span></span><span class="paren"><span class="p">(</span><span class="n">‹make-recursion›</span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
      <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
      <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><mark class="highlight-focus"><span class="n">fact</span></mark> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-10"><i class="far fa-copy"></i></button></div>
</div>
<p>produces the actual factorial function. However, this clearly won’t work, because the highlighted identifiers are going to be unbound. To fix this, we simply make it bound by wrapping a lambda function around the body.</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5
6</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-11"><span></span><span class="paren"><span class="p">(</span><span class="n">‹make-recursion›</span>
  <span class="paren"><span class="p">(</span><mark class="highlight-add"><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span></mark>
    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
      <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
        <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
        <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-11"><i class="far fa-copy"></i></button></div>
</div>
<p>We will call the lambda function that is the argument of <code>‹make-recursion›</code> a <em>recursion maker</em>. What we want then is to find <code>‹make-recursion›</code> so that for any <code>‹recursion-maker›</code>, <code>(‹make-recursion› ‹recursion-maker›)</code> produces the actual recursive function.</p>
<p>How should we approach this? We don’t know what <code>‹make-recursion›</code> looks like. But for the factorial function, we do know what <code>‹fact-maker›</code> looks like. The strategy, then, is to extract the <code>‹fact-maker›</code>:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-12"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
      <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
      <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-12"><i class="far fa-copy"></i></button></div>
</div>
<p>from our current code:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-13"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">n</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-13"><i class="far fa-copy"></i></button></div>
</div>
<p>Hopefully, what’s left is going to be <code>‹make-recursion›</code></p>
<p>To extract <code>‹fact-maker›</code>, as a first step, we can avoid prepending <code>fact</code> at the callsites of <code>fact</code> inside the lambda function. Simply transform:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-14"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">n</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-14"><i class="far fa-copy"></i></button></div>
</div>
<p>to</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5
6</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-15"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">n</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
                <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                  <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                  <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span></mark><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-15"><i class="far fa-copy"></i></button></div>
</div>
<p>which shadows <code>fact</code> that consumes two arguments with <code>fact</code> that consumes one argument while maintaining the semantics. The body of the function is now similar to <code>‹fact-maker›</code>, especially for the highlighted part. What can we do next? We see that <code>fact</code> and <code>n</code> are both the formal parameters in the transformed code, whereas in <code>‹fact-maker›</code> they are separated. Straightforwardly, we can use <a href="https://en.wikipedia.org/wiki/Currying">currying</a> to separate the two apart. We of course need to change how we call the function as well:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5
6
7</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-16"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
                  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                    <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                    <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-16"><i class="far fa-copy"></i></button></div>
</div>
<p>Notice that the let statement <code>(let ([fact ‹v›]) ...)</code> where <code>‹v›</code> is <code>(λ (n) ((fact fact) n))</code> can be lifted up without changing the semantics because <code>‹v›</code> doesn’t depend on the parameter <code>n</code>:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5
6
7</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-17"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
                <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                    <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                    <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span></mark><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-17"><i class="far fa-copy"></i></button></div>
</div>
<p>Our highlighted code is now even more similar to the <code>‹fact-maker›</code>. What we want to do next is to somehow convert <code>(let ([fact ‹v›]) ‹body›)</code> into <code>(λ (fact) ‹body›)</code> and move <code>‹v›</code> somewhere else. That’s simply desugaring <code>let</code>!</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5
6
7
8</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-18"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
              <span class="paren"><span class="p">(</span><mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
                 <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                   <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                     <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                     <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></mark>
               <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-18"><i class="far fa-copy"></i></button></div>
</div>
<p>and we finally have the <code>‹fact-maker›</code>!</p>
<p>Our next mission is to obtain the <code>‹make-recursion›</code>. To make things tidy, let’s first abstract <code>‹fact-maker›</code> out as a variable named <code>fact-maker</code>:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5
6
7</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-19"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
                    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                      <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                        <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                        <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-19"><i class="far fa-copy"></i></button></div>
</div>
<p>Recall that <code>(‹make-recursion› fact-maker)</code> should produce the actual factorial function which consumes only one number as an argument. Right now we still have <code>((fact fact) 3)</code> instead of <code>(fact 3)</code>. We can fix this using shadowing like what we did earlier:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5
6
7
8</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-20"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
                    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                      <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                        <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                        <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
      <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-20"><i class="far fa-copy"></i></button></div>
</div>
<p>There’s no <code>let</code> in lambda calculus, so we will reduce number of <code>let</code>s by fusing the two nested <code>let</code> together in a straightforward way:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5
6
7
8</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-21"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
                    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                      <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                        <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                        <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
               <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-21"><i class="far fa-copy"></i></button></div>
</div>
<p>As a final step, <code>‹make-recursion›</code> should consume <code>fact-maker</code> as an argument, so we can abstract <code>fact-maker</code> out:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-22"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
                    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                      <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                        <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                        <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span><span class="p">)</span></span>
                 <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
                  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
               <span class="n">fact-maker</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-22"><i class="far fa-copy"></i></button></div>
</div>
<p>And we are done! We have derived the <code>‹make-recursion›</code> as follows:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-23"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
   <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="n">fact</span><span class="p">)</span></span> <span class="n">n</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-23"><i class="far fa-copy"></i></button></div>
</div>
<p>Notice that there’s nothing inherent about the factorial function here. If we use the Fibonacci function as a starting point, we would end up with a term that is <a href="https://en.wikipedia.org/wiki/Lambda_calculus#Alpha_equivalence">$\alpha$-equivalent</a> to this <code>‹make-recursion›</code> as well. We will highlight this fact by $\alpha$-convert variable names to remove all references to the factorial function:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-24"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">f</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">v</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span> <span class="n">v</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
   <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">v</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span> <span class="n">v</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-24"><i class="far fa-copy"></i></button></div>
</div>
<p>This <code>‹make-recursion›</code> is formally known as the <em>Z combinator</em>, and we will subsequently call it $Z$. It is one of the well-known <em>fixed-point combinator</em>s. The word <a href="https://wiki.haskell.org/Combinator"><em>combinator</em></a> means that there’s no free variable in $Z$. The word <a href="https://en.wikipedia.org/wiki/Fixed_point_(mathematics)"><em>fixed-point</em></a> means that $Z(f)$ is a solution to the equation $x = f(x)$ for any function $f$. That is, $Z(f) = f(Z(f))$. While we can see evidently that $Z$ is a combinator, it’s not clear that $Z(f) = f(Z(f))$ is true or how this is important. This topic will be further investigated in the next sections.</p>
<p>Recall that the title of this section is <em>Deriving a fake Y combinator</em>. It’s fake because we actually derived the Z combinator, not the Y combinator. However, they are essentially the same. The difference of the two combinators will also be covered in the next sections.</p>
<p>Here’s our final code:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-25"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">Z</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">f</span><span class="p">)</span></span>
           <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">v</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span> <span class="n">v</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
            <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">v</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span> <span class="n">v</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
                      <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                        <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                          <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                          <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="n">Z</span> <span class="n">fact-maker</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
      <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-25"><i class="far fa-copy"></i></button></div>
</div>
<div class="highlight-container"><div class="highlight"><pre id="output-id-7">30</pre>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#output-id-7"><i class="far fa-copy"></i></button></div>
</div>
<h2>Fixed point</h2>
<p>The goal of this section is to see why $Z(f) = f(Z(f))$ and how it is important. First, we will take a look at recursion makers from another perspective. In the previous section, recursion makers arise naturally, but we only know that <code>(Z ‹recursion-maker›)</code> results in a recursive function. What exactly are their role and properties?</p>
<p>Let’s take a look at the fact maker as a concrete example:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-26"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
      <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
      <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-26"><i class="far fa-copy"></i></button></div>
</div>
<p>What can we pass into $\text{fact-maker}$? It obviously consumes the factorial function! But provided that we don’t have the real factorial function already, the best we can do is to provide any other value instead. Say, we pass in a non-sensible value $42$. This results in:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-27"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
    <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
    <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><mark class="highlight-focus"><span class="mi">42</span></mark> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-27"><i class="far fa-copy"></i></button></div>
</div>
<p>What we have here is the factorial function that only works on $n = 0$. For $n &gt; 0$, the highlighted $42$ will be used as a function value which results in an error. We will call this function $\text{fact}_0$.</p>
<p>What else can we pass into $\text{fact-maker}$? We just obtained $\text{fact}_0 = \text{fact-maker}(42)$, so we can use it. This results in:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-28"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
    <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
    <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact0</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-28"><i class="far fa-copy"></i></button></div>
</div>
<p>Again, what we have here is the factorial function that works on $n \le 1$. Let’s call it $\text{fact}_1$. Next, we can pass $\text{fact}_1 = \text{fact-maker}(\text{fact-maker}(42))$ into $\text{fact-maker}$ to get $\text{fact}_2$. We can clearly see the trend here. $\text{fact-maker}^k(42) = \text{fact}_{k-1}$, the factorial function that works on $n \le k - 1$.</p>
<p>In general, any recursion maker $f$ propels the computation one more level deeper.</p>
<p>To get the actual factorial function, which should work for any natural number $n$, we evidently need an infinitely high tower of $\text{fact-maker}$. That is, $\text{fact} = \text{fact}_\infty = \text{fact-maker}(\text{fact-maker}(\text{fact-maker}(\dots)))$.</p>
<p>Note that:</p>
<p>$$\begin{align*}<br/>\text{fact} &amp;= \text{fact-maker}(\text{fact-maker}(\dots))\\<br/>\text{fact-maker}(\text{fact}) &amp;= \text{fact-maker}(\text{fact-maker}(\text{fact-maker}(\dots))) &amp; \text{applying fact-maker}\\<br/> &amp;= \text{fact}\\<br/>\end{align*}$$</p>
<p>which agrees with our definition of $\text{fact-maker}$: applying $\text{fact}$ to $\text{fact-maker}$ produces the actual $\text{fact}$ function.</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-29"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
      <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
      <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-29"><i class="far fa-copy"></i></button></div>
</div>
<p>Recall that the Z combinator makes the recursion possible: $\text{fact} = Z(\text{fact-maker})$. Substituting this in the above equation, we obtain that $\text{fact-maker}(Z(\text{fact-maker})) = Z(\text{fact-maker})$.</p>
<p>In general, for any recursion maker $f$, $Z(f) = f(Z(f))$. The importance of this identity is that $Z(f) = f(Z(f)) = f(f(Z(f))) = f(f(f(Z(f)))) = \dots$ which creates an infinite tower of the recursion maker $f$, making recursion possible.</p>
<h3>Yet another proof</h3>
<p>We can also show that $Z(f) = f(Z(f))$ directly using the definition of $Z$:</p>
<p>$$\begin{align*}<br/>Z &amp;= \lam{f}{(\lam{x}{f (\lam{v}{(x x) v})})(\lam{x}{f (\lam{v}{(x x) v})})} &amp; \\<br/>Z(f) &amp;= (\lam{\color{red}{x}}{f (\lam{v}{(\color{red}{x x}) v})})(\lam{x}{f (\lam{v}{(x x) v})}) &amp; \\<br/>&amp;= f (\lam{\color{blue}{v}}{((\lam{x}{f (\lam{v}{(x x) v})}) (\lam{x}{f (\lam{v}{(x x) v})})) \color{blue}{v}}) &amp; \beta \text{-reduction}\\<br/>&amp;= f ((\lam{x}{f (\lam{v}{(x x) v})}) (\lam{x}{f (\lam{v}{(x x) v})})) &amp; \eta \text{-conversion}\\<br/>&amp;= f (Z(f)) &amp; \\<br/>\end{align*}$$</p>
<h2>The Y combinator</h2>
<p>In the previous sections, we derived the Z combinator:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-30"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">f</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">v</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span> <span class="n">v</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
   <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">v</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span> <span class="n">v</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-30"><i class="far fa-copy"></i></button></div>
</div>
<p>Using <a href="https://en.wikipedia.org/wiki/Lambda_calculus#%CE%B7-conversion">$\eta$-conversion</a>, we obtain the Y combinator:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-31"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">f</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
   <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-31"><i class="far fa-copy"></i></button></div>
</div>
<p>The $\eta$-conversion intuitively should preserve semantic equivalence. However, this is not totally true. In fact, any attempt to use <code>Y</code> will always result in an infinite loop in Racket (even though we have seen earlier that the Z combinator works)! We can manually step through the evaluation of <code>(Y make-fact)</code> to see what’s going on:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-32"><span></span><span class="mf">1.</span>  <span class="paren"><span class="p">(</span><mark class="highlight-focus"><span class="n">Y</span></mark> <span class="n">make-fact</span><span class="p">)</span></span>
<span class="n">==&gt;</span> <span class="paren"><span class="p">(</span><mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">f</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></mark> <span class="n">make-fact</span><span class="p">)</span></span>

<span class="mf">2.</span>  <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">f</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <mark class="highlight-focus"><span class="n">make-fact</span></mark><span class="p">)</span></span>
<span class="n">==&gt;</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">f</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span></mark><span class="p">)</span></span>

<span class="mf">3.</span>  <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">f</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span><span class="p">)</span></span></mark>
<span class="n">==&gt;</span> <mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></mark>

<span class="mf">4.</span>  <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></mark>
<span class="n">==&gt;</span> <mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span>
     <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></mark>

<span class="mf">5.</span>  <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span>
     <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></mark><span class="p">)</span></span>
<span class="n">==&gt;</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span>
     <mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span>
      <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></mark><span class="p">)</span></span>

<span class="mf">6.</span>  <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span>
     <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span>
      <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></mark><span class="p">)</span></span><span class="p">)</span></span>
<span class="n">==&gt;</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span>
     <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span>
      <mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span>
       <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></mark><span class="p">)</span></span><span class="p">)</span></span>

<span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-32"><i class="far fa-copy"></i></button></div>
</div>
<p>While Racket evaluates the term <code>(Y make-fact)</code> exactly as described above, we can imagine another way to evaluate the term:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-33"><span></span><span class="mf">1.</span>  <span class="paren"><span class="p">(</span><mark class="highlight-focus"><span class="n">Y</span></mark> <span class="n">make-fact</span><span class="p">)</span></span>
<span class="n">==&gt;</span> <span class="paren"><span class="p">(</span><mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">f</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></mark> <span class="n">make-fact</span><span class="p">)</span></span>

<span class="mf">2.</span>  <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">f</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="n">make-fact</span><span class="p">)</span></span></mark>
<span class="n">==&gt;</span> <mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></mark>

<span class="mf">3.</span>  <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></mark>
<span class="n">==&gt;</span> <mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></mark>

<span class="mf">4.</span>  <span class="paren"><span class="p">(</span><mark class="highlight-focus"><span class="n">make-fact</span></mark> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="n">==&gt;</span> <span class="paren"><span class="p">(</span><mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span></mark> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>

<span class="mf">5.</span>  <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span> <span class="k"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))">...</a></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span></mark>
<span class="n">==&gt;</span> <mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
      <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span>
        <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
        <span class="paren"><span class="p">[</span><span class="mi">1</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">make-fact</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
                 <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span></mark>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-33"><i class="far fa-copy"></i></button></div>
</div>
<p>In this evaluation trace, <code>(Y make-fact)</code> successfully evaluates to the factorial function! The difference of these two evaluation traces is due to <a href="https://en.wikipedia.org/wiki/Evaluation_strategy"><em>evaluation strategies</em></a><label for="margin-note-1" class="margin-note-toggle margin-note-number"></label><input type="checkbox" id="margin-note-1" class="margin-note-toggle"/><object class="margin-note"><div class="margin-note-box" decode="exclude-paragraph">I personally think that this Wikipedia page is poorly written (as of December 2018), so I will try to summarize the page in this section.</div>
</object>, which describes <em>what reducible term</em> (redex) should be <a href="https://en.wikipedia.org/wiki/Lambda_calculus#%CE%B2-reduction">$\beta$-reduced</a>.</p>
<p>Most programming languages, including Racket, uses the first evaluation strategy presented above which results in an infinite loop for <code>(Y make-fact)</code>. The strategy is named <em>call-by-value</em>, which always reduces the <em>leftmost-innermost</em> redex (outside of lambda functions). As another example, the strategy would evaluate <code>(double (double 1))</code> where <code>double</code> is defined as <code>(λ (x) (+ x x))</code> like this:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-34"><span></span><span class="paren"><span class="p">(</span><span class="n">double</span> <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="n">double</span> <span class="mi">1</span><span class="p">)</span></span></mark><span class="p">)</span></span> <span class="n">==&gt;</span> <span class="paren"><span class="p">(</span><span class="n">double</span> <mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span></span></mark><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="n">double</span> <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span></span></mark><span class="p">)</span></span>    <span class="n">==&gt;</span> <span class="paren"><span class="p">(</span><span class="n">double</span> <mark class="highlight-add"><span class="mi">2</span></mark><span class="p">)</span></span>
<mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="n">double</span> <span class="mi">2</span><span class="p">)</span></span></mark>          <span class="n">==&gt;</span> <mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span></span></mark>
<mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span></span></mark>             <span class="n">==&gt;</span> <mark class="highlight-add"><span class="mi">4</span></mark>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-34"><i class="far fa-copy"></i></button></div>
</div>
<p>The second strategy presented above which successfully evaluates <code>(Y make-fact)</code> to the factorial function is named <em>call-by-name</em>. The strategy always reduces the <em>rightmost-outermost</em> redex (outside of lambda functions). It would evaluate <code>(double (double 1))</code> like this:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5
6</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-35"><span></span><mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="n">double</span> <span class="paren"><span class="p">(</span><span class="n">double</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span></mark>       <span class="n">==&gt;</span> <mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">double</span> <span class="mi">1</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">double</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span></mark>
<span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="n">double</span> <span class="mi">1</span><span class="p">)</span></span></mark> <span class="paren"><span class="p">(</span><span class="n">double</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span> <span class="n">==&gt;</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span></span></mark> <span class="paren"><span class="p">(</span><span class="n">double</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span></span></mark> <span class="paren"><span class="p">(</span><span class="n">double</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span>    <span class="n">==&gt;</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <mark class="highlight-add"><span class="mi">2</span></mark> <span class="paren"><span class="p">(</span><span class="n">double</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">2</span> <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="n">double</span> <span class="mi">1</span><span class="p">)</span></span></mark><span class="p">)</span></span>          <span class="n">==&gt;</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">2</span> <mark class="highlight-add"><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span></span></mark><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">2</span> <mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span></span></mark><span class="p">)</span></span>             <span class="n">==&gt;</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">2</span> <mark class="highlight-add"><span class="mi">2</span></mark><span class="p">)</span></span>
<mark class="highlight-focus"><span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="mi">2</span> <span class="mi">2</span><span class="p">)</span></span></mark>                   <span class="n">==&gt;</span> <mark class="highlight-add"><span class="mi">4</span></mark>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-35"><i class="far fa-copy"></i></button></div>
</div>
<p>We have seen earlier that different evaluation stategies might not evaluate a term to the same result. This is disconcerting. Fortunately, the <a href="https://en.wikipedia.org/wiki/Church%E2%80%93Rosser_theorem">Church-Rosser theorem</a> guarantees that given a term $t$, <em>if two strategies successfully evaluate $t$ to values</em>, then the two values from both strategies are equal, as we can see from the <code>(double (double 1))</code> example. The only case that two evaluation strategies would evaluate a term to different results is when one of them doesn’t terminate, which is exactly what happens with the Y combinator.</p>
<p>There are advantages and disadvantages for each evaluation strategies. The call by name strategy, for example, has a beautiful property that if a term could be evaluated to a value by <em>some</em> evaluation strategy, then the call by name strategy will be able to evaluate the term to the value as well. The disadvantages are (1) it’s not really efficient, taking 6 steps to evaluate <code>(double (double 1))</code> while the call by value strategy can evaluate the term in only 4 steps, and (2) it doesn’t interact well with mutation which is a feature that exists in most programming languages. This is the reason why most programming languages use the call by value strategy.</p>
<p>Due to the call by value strategy, we can’t run the Y combinator in the standard Racket language. One cool feature of Racket however is its ability to create and use a new programming language via <a href="https://docs.racket-lang.org/guide/more-hash-lang.html">the hash lang line</a>. In fact, the creators of Racket even call Racket <a href="https://cacm.acm.org/magazines/2018/3/225475-a-programmable-programming-language/fulltext">a Programmable Programming Language</a>. It is very easy to create a call-by-name language with Racket. Even better, someone did that already and we can just use it!</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-36"><span></span><span class="kn">#lang </span><span class="nn">lazy</span>

<span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">Y</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">f</span><span class="p">)</span></span>
           <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
            <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">f</span> <span class="paren"><span class="p">(</span><span class="n">x</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact-maker</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span><span class="p">)</span></span>
                      <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">n</span><span class="p">)</span></span>
                        <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                          <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">1</span><span class="p">]</span></span>
                          <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))">*</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">fact</span> <span class="paren"><span class="p">(</span><span class="n">Y</span> <span class="n">fact-maker</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
      <span class="paren"><span class="p">(</span><span class="n">!</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">3</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="n">fact</span> <span class="mi">4</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="c1">;; we need to ! to force value for printing</span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-36"><i class="far fa-copy"></i></button></div>
</div>
<div class="highlight-container"><div class="highlight"><pre id="output-id-8">30</pre>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#output-id-8"><i class="far fa-copy"></i></button></div>
</div>
<p>It appears that call-by-value and call-by-name are also known as <em>applicative-order</em> and <em>normal-order</em> respectively<label for="margin-note-2" class="margin-note-toggle margin-note-number"></label><input type="checkbox" id="margin-note-2" class="margin-note-toggle"/><object class="margin-note"><div class="margin-note-box" decode="exclude-paragraph"><a href="http://www.cs.cornell.edu/courses/cs6110/2014sp/Lectures/lec04.pdf">Some sources</a> indicate that they are different because the applicative-order and normal-order strategy can perform reduction inside lambda functions, but this distinction doesn’t really matter for our purpose.</div>
</object>. For this reason, the Z combinator is also known as the applicative-order Y combinator.</p>
<h2>Y and me</h2>
<p>I learned the Y combinator two years ago from the <a href="https://cs.brown.edu/courses/cs173/">PL class</a> taught by <a href="https://cs.brown.edu/~sk/">Shriram Krishnamurthi</a>. One great explanation (which Shriram pointed us to) is <a href="http://felleisen.org/matthias/">Matthias Felleisen</a>’s <a href="https://xivilization.net/~marek/binaries/Y.pdf"><i>A Lecture of the Why of Y</i></a>, which similarly attempts to derive the Y combinator. However, the explanation that corresponds to the “Enabling recursion” section goes in a much slower pace and implicitly contains some elements from the “Fixed point” section. The strength of this approach in my opinion is that it crucially uses the fixed-point identity $Y(f) = f(Y(f))$ to justify the “self-application trick” in the derivation right away, so it motivates really well why $Y(f) = f(Y(f))$ is important. The approach that I use, on the other hand, simply focuses on where things are bound and how do we direct values to appropriate places, which results in a simpler explanation in my opinion. I also make use of <code>let</code> a lot, which I think helps a lot with readability, with the weakness being that I also need to talk about desugaring.</p>
<p>I didn’t discover this approach myself. The core insight of this approach is from a student’s homework that I graded in the <a href="https://cs.brown.edu/courses/cs173/2017/">current iteration</a> of the PL class. A part of the homework asks students to write random programs in a language that is very similar to Racket without <code>letrec</code> and mutation. I didn’t expect that students will be able to write a really meaningful program unless they know a fixed-point combinator already, ... or so I thought. It turns out that one student wrote a program to calculate 1 + 2 + ... + n for arbitrary n without knowing a fixed-point combinator! Here’s the program in Racket:</p>
<div class="highlight-container"><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv">
<pre>1
2
3
4
5</pre>
</div>
</td><td class="code"><div class="source"><pre class="racket" id="code-id-37"><span></span><span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))">let</a></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">triangle</span> <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))">λ</a></span> <span class="paren"><span class="p">(</span><span class="n">triangle</span> <span class="n">n</span><span class="p">)</span></span>
                  <span class="paren"><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))">case</a></span> <span class="n">n</span>
                    <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="mi">0</span><span class="p">)</span></span> <span class="mi">0</span><span class="p">]</span></span>
                    <span class="paren"><span class="p">[</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))">else</a></span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))">+</a></span> <span class="n">n</span> <span class="paren"><span class="p">(</span><span class="n">triangle</span> <span class="n">triangle</span> <span class="paren"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))">-</a></span> <span class="n">n</span> <span class="mi">1</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="n">triangle</span> <span class="n">triangle</span> <span class="mi">10</span><span class="p">)</span></span><span class="p">)</span></span>
</pre>
</div>
</td></tr></tbody></table>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#code-id-37"><i class="far fa-copy"></i></button></div>
</div>
<div class="highlight-container"><div class="highlight"><pre id="output-id-9">55</pre>
</div>
<div class="copy-button"><button type="button" class="btn btn-outline-secondary btn-sm" data-clipboard-target="#output-id-9"><i class="far fa-copy"></i></button></div>
</div>
<p>Granted, this is simply a rewrite of one of Matthias’s slides into the <code>let</code> form with uncurrying, but it really opened up my eyes.</p>
<h2>Acknowledgements</h2>
<p>Since our grading policy dictates that we can’t look at students’ name, I don’t know who this student is. Regardless, I would like to thank them for this incredible insight. I also would like to thank Shriram and Matthias for their teaching. Lastly, I thank <a href="https://homes.cs.washington.edu/~jrw12/">James Wilcox</a> for his various suggestions for this post.</p>
</div>
</p>
</div>
</div>
<footer><hr/><div class="float-md-left">Site generated by <a href="http://pollenpub.com">Pollen</a>/<a href="https://racket-lang.org">Racket</a></div>
<div class="float-md-right">© Sorawee Porncharoenwase</div>
</footer>
</main>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script src="https://homes.cs.washington.edu/~sorawee/static/js/bootstrap.bundle.min.js"></script><script src="https://homes.cs.washington.edu/~sorawee/static/js/script.js"></script></body>
</html>